{"ast":null,"code":"import _asyncToGenerator from \"C:/Projects/lib-workspace/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\n/**\n * @file ext-imagelib.js\n *\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria\n *\n */\nconst e = \"imagelib\",\n      loadExtensionTranslation = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (t) {\n    let d;\n    const b = t.configObj.pref(\"lang\");\n\n    try {\n      d = yield function __variableDynamicImportRuntime0__(e) {\n        switch (e) {\n          case \"./locale/de.js\":\n            return Promise.resolve().then(function () {\n              return i;\n            });\n\n          case \"./locale/en.js\":\n            return Promise.resolve().then(function () {\n              return n;\n            });\n\n          case \"./locale/fr.js\":\n            return Promise.resolve().then(function () {\n              return o;\n            });\n\n          case \"./locale/pl.js\":\n            return Promise.resolve().then(function () {\n              return r;\n            });\n\n          case \"./locale/pt-BR.js\":\n            return Promise.resolve().then(function () {\n              return s;\n            });\n\n          case \"./locale/ro.js\":\n            return Promise.resolve().then(function () {\n              return l;\n            });\n\n          case \"./locale/sk.js\":\n            return Promise.resolve().then(function () {\n              return a;\n            });\n\n          case \"./locale/sl.js\":\n            return Promise.resolve().then(function () {\n              return c;\n            });\n\n          case \"./locale/zh-CN.js\":\n            return Promise.resolve().then(function () {\n              return m;\n            });\n\n          default:\n            return new Promise(function (t, i) {\n              (\"function\" == typeof queueMicrotask ? queueMicrotask : setTimeout)(i.bind(null, new Error(\"Unknown variable dynamic import: \" + e)));\n            });\n        }\n      }(\"./locale/\".concat(b, \".js\"));\n    } catch (t) {\n      console.warn(\"Missing translation (\".concat(b, \") for \").concat(e, \" - using 'en'\")), d = yield Promise.resolve().then(function () {\n        return n;\n      });\n    }\n\n    t.i18next.addResourceBundle(b, e, d.default);\n  });\n\n  return function loadExtensionTranslation(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar t = {\n  name: e,\n\n  init(t) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      let {\n        decode64: i,\n        dropXMLInternalSubset: n\n      } = t;\n      const o = _this,\n            {\n        $id: r\n      } = o.svgCanvas,\n            {\n        $svgEditor: s\n      } = o,\n            {\n        imgPath: l\n      } = o.configObj.curConfig;\n      yield loadExtensionTranslation(o);\n\n      const {\n        svgCanvas: a\n      } = o,\n            c = [{\n        name: o.i18next.t(\"\".concat(e, \":imgLibs_0_name\")),\n        url: \"extensions/ext-imagelib/index.html\",\n        description: o.i18next.t(\"\".concat(e, \":imgLibs_0_description\"))\n      }, {\n        name: o.i18next.t(\"\".concat(e, \":imgLibs_1_name\")),\n        url: \"https://ian.umces.edu/symbols/catalog/svgedit/album_chooser.php?svgedit=3\",\n        description: o.i18next.t(\"\".concat(e, \":imgLibs_1_description\"))\n      }],\n            m = c.map(e => {\n        let {\n          url: t\n        } = e;\n\n        try {\n          return new URL(t).origin;\n        } catch (e) {\n          return location.origin;\n        }\n      }),\n            closeBrowser = () => {\n        r(\"imgbrowse_holder\").style.display = \"none\", document.activeElement.blur();\n      },\n            importImage = e => {\n        const t = a.addSVGElementsFromJson({\n          element: \"image\",\n          attr: {\n            x: 0,\n            y: 0,\n            width: 0,\n            height: 0,\n            id: a.getNextId(),\n            style: \"pointer-events:inherit\"\n          }\n        });\n        a.clearSelection(), a.addToSelection([t]), a.setImageURL(e);\n      },\n            d = {};\n\n      let b,\n          p,\n          u = \"s\",\n          g = [],\n          _ = !1;\n\n      window.addEventListener(\"message\", /*#__PURE__*/function () {\n        var _onMessage = _asyncToGenerator(function* (e) {\n          let t,\n              r,\n              s,\n              l,\n              c,\n              h,\n              {\n            origin: y,\n            data: f\n          } = e,\n              v = f;\n\n          if (v && [\"string\", \"object\"].includes(typeof v)) {\n            try {\n              if (v = \"object\" == typeof v ? v : JSON.parse(v), \"imagelib\" !== v.namespace) return;\n              if (!m.includes(\"*\") && !m.includes(y)) return void console.error(\"Origin \".concat(y, \" not whitelisted for posting to \").concat(window.origin));\n              const e = (\"name\" in v);\n              if (!e && _) return void (_ = !1);\n              \"href\" in v && (t = v.href, v = v.data), document.querySelector(\"se-elix-alert-dialog\") && document.querySelector(\"se-elix-alert-dialog\").remove(), r = e ? \"meta\" : v.charAt(0);\n            } catch (e) {\n              if (\"string\" == typeof v) {\n                const e = v.charAt(0);\n                if (\"{\" !== e && _) return void (_ = !1);\n\n                if (\"|\" === e) {\n                  const e = v.indexOf(\"|\", 1);\n                  t = v.substr(1, e - 1), v = v.substr(e + 1), r = v.charAt(0);\n                }\n              }\n            }\n\n            switch (r) {\n              case \"meta\":\n                {\n                  _ = !1, l = v, d[l.id] = l;\n                  const e = l.name || \"file\",\n                        t = o.i18next.t(\"notification.retrieving\").replace(\"%s\", e);\n                  return void (\"m\" !== u ? (yield seConfirm(t), _ = !0) : (s = document.createElement(\"div\"), s.textContent = t, s.dataset.id = l.id, b.appendChild(s), l.entry = s));\n                }\n\n              case \"<\":\n                c = !0;\n                break;\n\n              case \"d\":\n                if (v.startsWith(\"data:image/svg+xml\")) {\n                  const e = \"data:image/svg+xml;base64,\",\n                        t = v.substring(e.length);\n                  v = i(t), c = !0;\n                  break;\n                }\n\n                if (v.startsWith(\"data:image/\")) {\n                  h = !0;\n                  break;\n                }\n\n              default:\n                return void (\"m\" !== u ? closeBrowser() : d[t].entry.remove());\n            }\n\n            switch (u) {\n              case \"s\":\n                c ? o.svgCanvas.importSvgString(v) : h && importImage(v), closeBrowser();\n                break;\n\n              case \"m\":\n                {\n                  let e;\n\n                  if (g.push([c ? \"svg\" : \"img\", v]), l = d[t], c) {\n                    if (l && l.name) e = l.name;else {\n                      const t = new DOMParser().parseFromString(n(v), \"text/xml\").documentElement;\n                      e = t.querySelector(\"title\").textContent || \"(SVG #\" + v.length + \")\";\n                    }\n                    if (l) Array.from(b.children).forEach(function (i) {\n                      if (i.dataset.id === t) {\n                        if (l.preview_url) {\n                          const e = document.createElement(\"img\");\n                          e.src = l.preview_url;\n                          const t = document.createElement(\"span\");\n                          t.appendChild(e), i.append(t);\n                        } else i.textContent = e;\n\n                        p.removeAttribute(\"disabled\");\n                      }\n                    });else {\n                      const t = document.createElement(\"div\");\n                      t.textContent = e, b.appendChild(t), p.removeAttribute(\"disabled\");\n                    }\n                  } else {\n                    if (l && l.preview_url) {\n                      e = l.name || \"\", s = document.createElement(\"span\");\n                      const t = document.createElement(\"img\");\n                      t.src = l.preview_url, s.appendChild(t), s.appendChild(document.createTextNode(e));\n                    } else s = document.createElement(\"img\"), s.src = v;\n\n                    if (l) Array.from(b.children).forEach(function (e) {\n                      e.dataset.id === t && (e.appendChild(s), p.removeAttribute(\"disabled\"));\n                    });else {\n                      const e = document.createElement(\"div\");\n                      e.appendChild(s), b.appendChild(e), p.removeAttribute(\"disabled\");\n                    }\n                  }\n\n                  break;\n                }\n\n              case \"o\":\n                if (!c) break;\n                closeBrowser();\n                if (!(yield o.openPrep())) return;\n                a.clear(), a.setSvgString(v);\n                break;\n            }\n          }\n        });\n\n        function onMessage(_x2) {\n          return _onMessage.apply(this, arguments);\n        }\n\n        return onMessage;\n      }(), !0);\n\n      const insertAfter = (e, t) => {\n        e.parentNode.insertBefore(t, e.nextSibling);\n      },\n            toggleMultiLoop = () => {\n        for (g.forEach(function (e, t) {\n          const i = e[0],\n                n = e[1];\n          \"svg\" === i ? a.importSvgString(n) : importImage(n), a.moveSelectedElements(20 * t, 20 * t, !1);\n        }); b.firstChild;) b.removeChild(b.firstChild);\n\n        g = [], r(\"imgbrowse_holder\").style.display = \"none\";\n      },\n            toggleMulti = e => {\n        r(\"lib_framewrap\").style.right = e ? 200 : 10, r(\"imglib_opts\").style.right = e ? 200 : 10, b || (b = document.createElement(\"div\"), b.setAttribute(\"id\", \"imglib_preview\"), b.setAttribute(\"style\", \"position: absolute;top: 45px;right: 10px;width: 180px;bottom: 45px;background: #fff;overflow: auto;\"), insertAfter(r(\"lib_framewrap\"), b), p = document.createElement(\"button\"), p.setAttribute(\"content\", \"Import selected\"), p.setAttribute(\"disabled\", !0), p.textContent = \"Import selected\", p.setAttribute(\"style\", \"position: absolute;bottom: 10px;right: -10px;\"), r(\"imgbrowse\").appendChild(p), p.addEventListener(\"click\", toggleMultiLoop), p.addEventListener(\"touchend\", toggleMultiLoop)), p.style.display = e ? \"block\" : \"none\", b.style.display = e ? \"block\" : \"none\";\n      },\n            showBrowser = () => {\n        let t = r(\"imgbrowse\");\n        if (t) r(\"imgbrowse_holder\").style.display = \"block\";else {\n          const i = document.createElement(\"div\");\n          i.id = \"imgbrowse_holder\", i.innerHTML = \"<div id=imgbrowse class=toolbar_button></div>\", insertAfter(s, i), t = r(\"imgbrowse\");\n          const n = o.i18next.t(\"\".concat(e, \":select_lib\")),\n                a = document.createElement(\"div\");\n          a.id = \"lib_framewrap\";\n          const m = document.createElement(\"ul\");\n          m.id = \"imglib_opts\", t.append(m);\n          const d = document.createElement(\"iframe\");\n          d.src = \"javascript:0\", d.style.display = \"none\", a.append(d), t.prepend(a);\n          const b = document.createElement(\"h1\");\n          t.prepend(b), b.textContent = n, b.setAttribute(\"style\", \"position: absolute;top: 0px;left: 0px;width: 100%;\");\n          const p = document.createElement(\"button\");\n          p.innerHTML = o.i18next.t(\"common.cancel\"), t.appendChild(p), p.addEventListener(\"click\", function () {\n            r(\"imgbrowse_holder\").style.display = \"none\";\n          }), p.addEventListener(\"touchend\", function () {\n            r(\"imgbrowse_holder\").style.display = \"none\";\n          }), p.setAttribute(\"style\", \"position: absolute;top: 5px;right: 10px;\");\n          const g = document.createElement(\"span\");\n          g.setAttribute(\"style\", \"position: absolute;top: 5px;left: 10px;display: inline-flex;\"), t.appendChild(g);\n\n          const _ = document.createElement(\"button\");\n\n          _.style.visibility = \"hidden\", _.innerHTML = '<img class=\"svg_icon\" src=\"'.concat(l, '/library.svg\" alt=\"icon\" width=\"16\" height=\"16\" />') + o.i18next.t(\"\".concat(e, \":show_list\")), g.appendChild(_), _.addEventListener(\"click\", function () {\n            d.setAttribute(\"src\", \"about:blank\"), d.style.display = \"none\", m.style.display = \"block\", b.textContent = n, _.style.display = \"none\";\n          }), _.addEventListener(\"touchend\", function () {\n            d.setAttribute(\"src\", \"about:blank\"), d.style.display = \"none\", m.style.display = \"block\", b.textContent = n, _.style.display = \"none\";\n          }), _.setAttribute(\"style\", \"margin-right: 5px;\"), _.style.display = \"none\";\n          const h = document.createElement(\"select\");\n          h.innerHTML = \"<select><option value=s>\" + o.i18next.t(\"\".concat(e, \":import_single\")) + \"</option><option value=m>\" + o.i18next.t(\"\".concat(e, \":import_multi\")) + \"</option><option value=o>\" + o.i18next.t(\"\".concat(e, \":open\")) + \"</option>\", g.appendChild(h), h.addEventListener(\"change\", function () {\n            switch (u = this.value, u) {\n              case \"s\":\n              case \"o\":\n                toggleMulti(!1);\n                break;\n\n              case \"m\":\n                toggleMulti(!0);\n            }\n          }), h.setAttribute(\"style\", \"margin-top: 10px;\"), c.forEach(function (e) {\n            let {\n              name: t,\n              url: i,\n              description: n\n            } = e;\n            const o = document.createElement(\"li\");\n            m.appendChild(o), o.textContent = t, o.addEventListener(\"click\", function () {\n              d.setAttribute(\"src\", i), d.style.display = \"block\", b.textContent = t, m.style.display = \"none\", _.style.display = \"block\";\n            }), o.addEventListener(\"touchend\", function () {\n              d.setAttribute(\"src\", i), d.style.display = \"block\", b.textContent = t, m.style.display = \"none\", _.style.display = \"block\";\n            });\n            const r = document.createElement(\"span\");\n            r.textContent = n, o.appendChild(r);\n          });\n        }\n      };\n\n      return {\n        svgicons: \"ext-imagelib.xml\",\n\n        callback() {\n          const e = document.createElement(\"template\");\n          e.innerHTML = '\\n        <se-menu-item id=\"tool_imagelib\" label=\"'.concat(\"imagelib:buttons.0.title\", '\" src=\"library.svg\"></se-menu-item>\\n        '), insertAfter(r(\"tool_export\"), e.content.cloneNode(!0)), r(\"tool_imagelib\").addEventListener(\"click\", () => {\n            showBrowser();\n          });\n          const t = document.createElement(\"style\");\n          t.textContent = \"#imgbrowse_holder {position: absolute;top: 0;left: 0;width: 100%;height: 100%;background-color: rgba(0, 0, 0, .5);z-index: 5;}#imgbrowse {position: absolute;top: 25px;left: 25px;right: 25px;bottom: 25px;min-width: 300px;min-height: 200px;background: #5a6162;border: 1px outset #777;}#imgbrowse h1 {font-size: 20px;margin: .4em;text-align: center;}#lib_framewrap,#imgbrowse > ul {position: absolute;top: 45px;left: 10px;right: 10px;bottom: 10px;background: white;margin: 0;padding: 0;}#imgbrowse > ul {overflow: auto;}#imgbrowse > div {border: 1px solid #666;}#imglib_preview > div {padding: 5px;font-size: 12px;}#imglib_preview img {display: block;margin: 0 auto;max-height: 100px;}#imgbrowse li {list-style: none;padding: .5em;background: #E8E8E8;border-bottom: 1px solid #5a6162;line-height: 1.2em;font-style: sans-serif;}#imgbrowse li > span {color: #666;font-size: 15px;display: block;}#imgbrowse li:hover {background: #FFC;cursor: pointer;}#imgbrowse iframe {width: 100%;height: 100%;border: 0;}\", document.head.appendChild(t);\n        }\n\n      };\n    })();\n  }\n\n},\n    i = Object.freeze({\n  __proto__: null,\n  default: {\n    select_lib: \"Select an image library\",\n    show_list: \"Show library list\",\n    import_single: \"Import single\",\n    import_multi: \"Import multiple\",\n    open: \"Open as new document\",\n    buttons: [{\n      title: \"Bilder-Bibliothek\"\n    }],\n    imgLibs_0_name: \"Demo library (local)\",\n    imgLibs_0_description: \"Demonstration library for SVG-edit on this server\",\n    imgLibs_1_name: \"IAN Symbol Libraries\",\n    imgLibs_1_description: \"Free library of illustrations\"\n  }\n}),\n    n = Object.freeze({\n  __proto__: null,\n  default: {\n    select_lib: \"Select an image library\",\n    show_list: \"Show library list\",\n    import_single: \"Import single\",\n    import_multi: \"Import multiple\",\n    open: \"Open as new document\",\n    buttons: [{\n      title: \"Image library\"\n    }],\n    imgLibs_0_name: \"Demo library (local)\",\n    imgLibs_0_description: \"Demonstration library for SVG-edit on this server\",\n    imgLibs_1_name: \"IAN Symbol Libraries\",\n    imgLibs_1_description: \"Free library of illustrations\"\n  }\n}),\n    o = Object.freeze({\n  __proto__: null,\n  default: {\n    select_lib: \"Choisir une bibliothèque d'images\",\n    show_list: \"show_list\",\n    import_single: \"import_single\",\n    import_multi: \"import_multi\",\n    open: \"open\",\n    buttons: [{\n      title: \"Bibliothèque d'images\"\n    }],\n    imgLibs_0_name: \"Demo library (local)\",\n    imgLibs_0_description: \"Demonstration library for SVG-edit on this server\",\n    imgLibs_1_name: \"IAN Symbol Libraries\",\n    imgLibs_1_description: \"Free library of illustrations\"\n  }\n}),\n    r = Object.freeze({\n  __proto__: null,\n  default: {\n    select_lib: \"Select an image library\",\n    show_list: \"Show library list\",\n    import_single: \"Import single\",\n    import_multi: \"Import multiple\",\n    open: \"Open as new document\",\n    buttons: [{\n      title: \"Biblioteka obrazów\"\n    }],\n    imgLibs_0_name: \"Demo library (local)\",\n    imgLibs_0_description: \"Demonstration library for SVG-edit on this server\",\n    imgLibs_1_name: \"IAN Symbol Libraries\",\n    imgLibs_1_description: \"Free library of illustrations\"\n  }\n}),\n    s = Object.freeze({\n  __proto__: null,\n  default: {\n    select_lib: \"Select an image library\",\n    show_list: \"Show library list\",\n    import_single: \"Import single\",\n    import_multi: \"Import multiple\",\n    open: \"Open as new document\",\n    buttons: [{\n      title: \"Biblioteca de Imagens\"\n    }],\n    imgLibs_0_name: \"Demo library (local)\",\n    imgLibs_0_description: \"Demonstration library for SVG-edit on this server\",\n    imgLibs_1_name: \"IAN Symbol Libraries\",\n    imgLibs_1_description: \"Free library of illustrations\"\n  }\n}),\n    l = Object.freeze({\n  __proto__: null,\n  default: {\n    select_lib: \"Select an image library\",\n    show_list: \"Show library list\",\n    import_single: \"Import single\",\n    import_multi: \"Import multiple\",\n    open: \"Open as new document\",\n    buttons: [{\n      title: \"Bibliotecă de Imagini\"\n    }],\n    imgLibs_0_name: \"Demo library (local)\",\n    imgLibs_0_description: \"Demonstration library for SVG-edit on this server\",\n    imgLibs_1_name: \"IAN Symbol Libraries\",\n    imgLibs_1_description: \"Free library of illustrations\"\n  }\n}),\n    a = Object.freeze({\n  __proto__: null,\n  default: {\n    select_lib: \"Select an image library\",\n    show_list: \"Show library list\",\n    import_single: \"Import single\",\n    import_multi: \"Import multiple\",\n    open: \"Open as new document\",\n    buttons: [{\n      title: \"Knižnica obrázkov\"\n    }],\n    imgLibs_0_name: \"Demo library (local)\",\n    imgLibs_0_description: \"Demonstration library for SVG-edit on this server\",\n    imgLibs_1_name: \"IAN Symbol Libraries\",\n    imgLibs_1_description: \"Free library of illustrations\"\n  }\n}),\n    c = Object.freeze({\n  __proto__: null,\n  default: {\n    select_lib: \"Select an image library\",\n    show_list: \"Show library list\",\n    import_single: \"Import single\",\n    import_multi: \"Import multiple\",\n    open: \"Open as new document\",\n    buttons: [{\n      title: \"Knjižnica slik\"\n    }],\n    imgLibs_0_name: \"Demo library (local)\",\n    imgLibs_0_description: \"Demonstration library for SVG-edit on this server\",\n    imgLibs_1_name: \"IAN Symbol Libraries\",\n    imgLibs_1_description: \"Free library of illustrations\"\n  }\n}),\n    m = Object.freeze({\n  __proto__: null,\n  default: {\n    select_lib: \"Select an image library\",\n    show_list: \"Show library list\",\n    import_single: \"Import single\",\n    import_multi: \"Import multiple\",\n    open: \"Open as new document\",\n    buttons: [{\n      title: \"图像库\"\n    }],\n    imgLibs_0_name: \"Demo library (local)\",\n    imgLibs_0_description: \"Demonstration library for SVG-edit on this server\",\n    imgLibs_1_name: \"IAN Symbol Libraries\",\n    imgLibs_1_description: \"Free library of illustrations\"\n  }\n});\nexport { t as default }; //# sourceMappingURL=ext-imagelib.js.map","map":null,"metadata":{},"sourceType":"module"}