{"ast":null,"code":"import _asyncToGenerator from \"C:/Projects/lib-workspace/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\n/**\n * @file ext-grid.js\n *\n * @license Apache-2.0\n *\n * @copyright 2010 Redou Mine, 2010 Alexis Deveria\n *\n */\nconst loadExtensionTranslation = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (e) {\n    let o;\n    const r = e.configObj.pref(\"lang\");\n\n    try {\n      o = yield function __variableDynamicImportRuntime0__(e) {\n        switch (e) {\n          case \"./locale/en.js\":\n            return Promise.resolve().then(function () {\n              return t;\n            });\n\n          case \"./locale/fr.js\":\n            return Promise.resolve().then(function () {\n              return n;\n            });\n\n          case \"./locale/zh-CN.js\":\n            return Promise.resolve().then(function () {\n              return i;\n            });\n\n          default:\n            return new Promise(function (t, n) {\n              (\"function\" == typeof queueMicrotask ? queueMicrotask : setTimeout)(n.bind(null, new Error(\"Unknown variable dynamic import: \" + e)));\n            });\n        }\n      }(\"./locale/\".concat(r, \".js\"));\n    } catch (e) {\n      console.warn(\"Missing translation (\".concat(r, \") for \").concat(\"grid\", \" - using 'en'\")), o = yield Promise.resolve().then(function () {\n        return t;\n      });\n    }\n\n    e.i18next.addResourceBundle(r, \"grid\", o.default);\n  });\n\n  return function loadExtensionTranslation(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar e = {\n  name: \"grid\",\n\n  init() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const e = _this;\n      yield loadExtensionTranslation(e);\n      const {\n        svgCanvas: t\n      } = e,\n            {\n        $id: n,\n        NS: i\n      } = t,\n            o = n(\"svgcanvas\").ownerDocument,\n            {\n        assignAttributes: r\n      } = t,\n            a = document.createElement(\"canvas\"),\n            s = n(\"canvasBackground\"),\n            c = t.getTypeMap(),\n            l = [.01, .1, 1, 10, 100, 1e3];\n      let d = e.configObj.curConfig.showGrid || !1;\n      a.style.display = \"none\", e.$svgEditor.appendChild(a);\n      const u = o.createElementNS(i.SVG, \"svg\");\n      r(u, {\n        id: \"canvasGrid\",\n        width: \"100%\",\n        height: \"100%\",\n        x: 0,\n        y: 0,\n        overflow: \"visible\",\n        display: \"none\"\n      }), s.appendChild(u);\n      const g = o.createElementNS(i.SVG, \"defs\"),\n            h = o.createElementNS(i.SVG, \"pattern\");\n      r(h, {\n        id: \"gridpattern\",\n        patternUnits: \"userSpaceOnUse\",\n        x: 0,\n        y: 0,\n        width: 100,\n        height: 100\n      });\n      const p = o.createElementNS(i.SVG, \"image\");\n      r(p, {\n        x: 0,\n        y: 0,\n        width: 100,\n        height: 100\n      }), h.append(p), g.append(h), n(\"canvasGrid\").appendChild(g);\n      const f = o.createElementNS(i.SVG, \"rect\");\n      r(f, {\n        width: \"100%\",\n        height: \"100%\",\n        x: 0,\n        y: 0,\n        \"stroke-width\": 0,\n        stroke: \"none\",\n        fill: \"url(#gridpattern)\",\n        style: \"pointer-events: none; display:visible;\"\n      }), n(\"canvasGrid\").appendChild(f);\n\n      const updateGrid = n => {\n        const i = c[e.configObj.curConfig.baseUnit] * n,\n              o = 100 / i;\n        let r = 1;\n        l.some(e => (r = e, o <= e));\n        const s = r * i;\n        a.width = s, a.height = s;\n        const d = a.getContext(\"2d\"),\n              u = .5,\n              g = s / 10;\n        d.globalAlpha = .2, d.strokeStyle = e.configObj.curConfig.gridColor;\n\n        for (let e = 1; e < 10; e++) {\n          const t = Math.round(g * e) + .5,\n                n = 0;\n          d.moveTo(t, s), d.lineTo(t, n), d.moveTo(s, t), d.lineTo(n, t);\n        }\n\n        d.stroke(), d.beginPath(), d.globalAlpha = .5, d.moveTo(u, s), d.lineTo(u, 0), d.moveTo(s, u), d.lineTo(0, u), d.stroke();\n        const h = a.toDataURL(\"image/png\");\n        p.setAttribute(\"width\", s), p.setAttribute(\"height\", s), p.parentNode.setAttribute(\"width\", s), p.parentNode.setAttribute(\"height\", s), t.setHref(p, h);\n      },\n            gridUpdate = () => {\n        d && updateGrid(t.getZoom()), n(\"canvasGrid\").style.display = d ? \"block\" : \"none\", n(\"view_grid\").pressed = d;\n      };\n\n      return {\n        name: e.i18next.t(\"\".concat(\"grid\", \":name\")),\n\n        zoomChanged(e) {\n          d && updateGrid(e);\n        },\n\n        callback() {\n          const t = document.createElement(\"template\"),\n                i = \"\".concat(\"grid\", \":buttons.0.title\");\n          t.innerHTML = '\\n          <se-button id=\"view_grid\" title=\"'.concat(i, '\" src=\"grid.svg\"></se-button>\\n        '), n(\"editor_panel\").append(t.content.cloneNode(!0)), n(\"view_grid\").addEventListener(\"click\", () => {\n            e.configObj.curConfig.showGrid = d = !d, gridUpdate();\n          }), d && gridUpdate();\n        }\n\n      };\n    })();\n  }\n\n},\n    t = Object.freeze({\n  __proto__: null,\n  default: {\n    name: \"View Grid\",\n    buttons: [{\n      title: \"Show/Hide Grid\"\n    }]\n  }\n}),\n    n = Object.freeze({\n  __proto__: null,\n  default: {\n    name: \"Grille\",\n    buttons: [{\n      title: \"Afficher/Cacher Grille\"\n    }]\n  }\n}),\n    i = Object.freeze({\n  __proto__: null,\n  default: {\n    name: \"网格视图\",\n    buttons: [{\n      title: \"显示/隐藏网格\"\n    }]\n  }\n});\nexport { e as default }; //# sourceMappingURL=ext-grid.js.map","map":null,"metadata":{},"sourceType":"module"}