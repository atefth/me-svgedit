{"ast":null,"code":"import _asyncToGenerator from \"C:/Projects/lib-workspace/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\n/**\n * @file ext-grid.js\n *\n * @license Apache-2.0\n *\n * @copyright 2010 Redou Mine, 2010 Alexis Deveria\n *\n */\nconst loadExtensionTranslation = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator(function* (e) {\n    let o;\n    const r = e.configObj.pref(\"lang\");\n\n    try {\n      o = yield function __variableDynamicImportRuntime0__(e) {\n        switch (e) {\n          case \"./locale/en.js\":\n            return Promise.resolve().then(function () {\n              return t;\n            });\n\n          case \"./locale/fr.js\":\n            return Promise.resolve().then(function () {\n              return n;\n            });\n\n          case \"./locale/zh-CN.js\":\n            return Promise.resolve().then(function () {\n              return i;\n            });\n\n          default:\n            return new Promise(function (t, n) {\n              (\"function\" == typeof queueMicrotask ? queueMicrotask : setTimeout)(n.bind(null, new Error(\"Unknown variable dynamic import: \" + e)));\n            });\n        }\n      }(\"./locale/\".concat(r, \".js\"));\n    } catch (e) {\n      console.warn(\"Missing translation (\".concat(r, \") for \").concat(\"grid\", \" - using 'en'\")), o = yield Promise.resolve().then(function () {\n        return t;\n      });\n    }\n\n    e.i18next.addResourceBundle(r, \"grid\", o.default);\n  });\n\n  return function loadExtensionTranslation(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nvar e = {\n  name: \"grid\",\n\n  init() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const e = _this;\n      yield loadExtensionTranslation(e);\n      const {\n        svgCanvas: t\n      } = e,\n            {\n        $id: n,\n        NS: i\n      } = t,\n            o = n(\"svgcanvas\").ownerDocument,\n            {\n        assignAttributes: r\n      } = t,\n            a = document.createElement(\"canvas\"),\n            s = n(\"canvasBackground\"),\n            c = t.getTypeMap(),\n            l = [.01, .1, 1, 10, 100, 1e3];\n      let d = e.configObj.curConfig.showGrid || !1;\n      a.style.display = \"none\", e.$svgEditor.appendChild(a);\n      const u = o.createElementNS(i.SVG, \"svg\");\n      r(u, {\n        id: \"canvasGrid\",\n        width: \"100%\",\n        height: \"100%\",\n        x: 0,\n        y: 0,\n        overflow: \"visible\",\n        display: \"none\"\n      }), s.appendChild(u);\n      const g = o.createElementNS(i.SVG, \"defs\"),\n            h = o.createElementNS(i.SVG, \"pattern\");\n      r(h, {\n        id: \"gridpattern\",\n        patternUnits: \"userSpaceOnUse\",\n        x: 0,\n        y: 0,\n        width: 100,\n        height: 100\n      });\n      const p = o.createElementNS(i.SVG, \"image\");\n      r(p, {\n        x: 0,\n        y: 0,\n        width: 100,\n        height: 100\n      }), h.append(p), g.append(h), n(\"canvasGrid\").appendChild(g);\n      const f = o.createElementNS(i.SVG, \"rect\");\n      r(f, {\n        width: \"100%\",\n        height: \"100%\",\n        x: 0,\n        y: 0,\n        \"stroke-width\": 0,\n        stroke: \"none\",\n        fill: \"url(#gridpattern)\",\n        style: \"pointer-events: none; display:visible;\"\n      }), n(\"canvasGrid\").appendChild(f);\n\n      const updateGrid = n => {\n        const i = c[e.configObj.curConfig.baseUnit] * n,\n              o = 100 / i;\n        let r = 1;\n        l.some(e => (r = e, o <= e));\n        const s = r * i;\n        a.width = s, a.height = s;\n        const d = a.getContext(\"2d\"),\n              u = .5,\n              g = s / 10;\n        d.globalAlpha = .2, d.strokeStyle = e.configObj.curConfig.gridColor;\n\n        for (let e = 1; e < 10; e++) {\n          const t = Math.round(g * e) + .5,\n                n = 0;\n          d.moveTo(t, s), d.lineTo(t, n), d.moveTo(s, t), d.lineTo(n, t);\n        }\n\n        d.stroke(), d.beginPath(), d.globalAlpha = .5, d.moveTo(u, s), d.lineTo(u, 0), d.moveTo(s, u), d.lineTo(0, u), d.stroke();\n        const h = a.toDataURL(\"image/png\");\n        p.setAttribute(\"width\", s), p.setAttribute(\"height\", s), p.parentNode.setAttribute(\"width\", s), p.parentNode.setAttribute(\"height\", s), t.setHref(p, h);\n      },\n            gridUpdate = () => {\n        d && updateGrid(t.getZoom()), n(\"canvasGrid\").style.display = d ? \"block\" : \"none\", n(\"view_grid\").pressed = d;\n      };\n\n      return {\n        name: e.i18next.t(\"\".concat(\"grid\", \":name\")),\n\n        zoomChanged(e) {\n          d && updateGrid(e);\n        },\n\n        callback() {\n          const t = document.createElement(\"template\"),\n                i = \"\".concat(\"grid\", \":buttons.0.title\");\n          t.innerHTML = '\\n          <se-button id=\"view_grid\" title=\"'.concat(i, '\" src=\"grid.svg\"></se-button>\\n        '), n(\"editor_panel\").append(t.content.cloneNode(!0)), n(\"view_grid\").addEventListener(\"click\", () => {\n            e.configObj.curConfig.showGrid = d = !d, gridUpdate();\n          }), d && gridUpdate();\n        }\n\n      };\n    })();\n  }\n\n},\n    t = Object.freeze({\n  __proto__: null,\n  default: {\n    name: \"View Grid\",\n    buttons: [{\n      title: \"Show/Hide Grid\"\n    }]\n  }\n}),\n    n = Object.freeze({\n  __proto__: null,\n  default: {\n    name: \"Grille\",\n    buttons: [{\n      title: \"Afficher/Cacher Grille\"\n    }]\n  }\n}),\n    i = Object.freeze({\n  __proto__: null,\n  default: {\n    name: \"网格视图\",\n    buttons: [{\n      title: \"显示/隐藏网格\"\n    }]\n  }\n});\nexport { e as default }; //# sourceMappingURL=ext-grid.js.map","map":{"version":3,"sources":["C:/Projects/lib-workspace/node_modules/svgedit/dist/editor/extensions/ext-grid/ext-grid.js"],"names":["loadExtensionTranslation","e","o","r","configObj","pref","__variableDynamicImportRuntime0__","Promise","resolve","then","t","n","i","queueMicrotask","setTimeout","bind","Error","concat","console","warn","i18next","addResourceBundle","default","name","init","svgCanvas","$id","NS","ownerDocument","assignAttributes","a","document","createElement","s","c","getTypeMap","l","d","curConfig","showGrid","style","display","$svgEditor","appendChild","u","createElementNS","SVG","id","width","height","x","y","overflow","g","h","patternUnits","p","append","f","stroke","fill","updateGrid","baseUnit","some","getContext","globalAlpha","strokeStyle","gridColor","Math","round","moveTo","lineTo","beginPath","toDataURL","setAttribute","parentNode","setHref","gridUpdate","getZoom","pressed","zoomChanged","callback","innerHTML","content","cloneNode","addEventListener","Object","freeze","__proto__","buttons","title"],"mappings":"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","sourcesContent":["/**\n * @file ext-grid.js\n *\n * @license Apache-2.0\n *\n * @copyright 2010 Redou Mine, 2010 Alexis Deveria\n *\n */\nconst loadExtensionTranslation=async function(e){let o;const r=e.configObj.pref(\"lang\");try{o=await function __variableDynamicImportRuntime0__(e){switch(e){case\"./locale/en.js\":return Promise.resolve().then((function(){return t}));case\"./locale/fr.js\":return Promise.resolve().then((function(){return n}));case\"./locale/zh-CN.js\":return Promise.resolve().then((function(){return i}));default:return new Promise((function(t,n){(\"function\"==typeof queueMicrotask?queueMicrotask:setTimeout)(n.bind(null,new Error(\"Unknown variable dynamic import: \"+e)))}))}}(\"./locale/\".concat(r,\".js\"))}catch(e){console.warn(\"Missing translation (\".concat(r,\") for \").concat(\"grid\",\" - using 'en'\")),o=await Promise.resolve().then((function(){return t}))}e.i18next.addResourceBundle(r,\"grid\",o.default)};var e={name:\"grid\",async init(){const e=this;await loadExtensionTranslation(e);const{svgCanvas:t}=e,{$id:n,NS:i}=t,o=n(\"svgcanvas\").ownerDocument,{assignAttributes:r}=t,a=document.createElement(\"canvas\"),s=n(\"canvasBackground\"),c=t.getTypeMap(),l=[.01,.1,1,10,100,1e3];let d=e.configObj.curConfig.showGrid||!1;a.style.display=\"none\",e.$svgEditor.appendChild(a);const u=o.createElementNS(i.SVG,\"svg\");r(u,{id:\"canvasGrid\",width:\"100%\",height:\"100%\",x:0,y:0,overflow:\"visible\",display:\"none\"}),s.appendChild(u);const g=o.createElementNS(i.SVG,\"defs\"),h=o.createElementNS(i.SVG,\"pattern\");r(h,{id:\"gridpattern\",patternUnits:\"userSpaceOnUse\",x:0,y:0,width:100,height:100});const p=o.createElementNS(i.SVG,\"image\");r(p,{x:0,y:0,width:100,height:100}),h.append(p),g.append(h),n(\"canvasGrid\").appendChild(g);const f=o.createElementNS(i.SVG,\"rect\");r(f,{width:\"100%\",height:\"100%\",x:0,y:0,\"stroke-width\":0,stroke:\"none\",fill:\"url(#gridpattern)\",style:\"pointer-events: none; display:visible;\"}),n(\"canvasGrid\").appendChild(f);const updateGrid=n=>{const i=c[e.configObj.curConfig.baseUnit]*n,o=100/i;let r=1;l.some((e=>(r=e,o<=e)));const s=r*i;a.width=s,a.height=s;const d=a.getContext(\"2d\"),u=.5,g=s/10;d.globalAlpha=.2,d.strokeStyle=e.configObj.curConfig.gridColor;for(let e=1;e<10;e++){const t=Math.round(g*e)+.5,n=0;d.moveTo(t,s),d.lineTo(t,n),d.moveTo(s,t),d.lineTo(n,t)}d.stroke(),d.beginPath(),d.globalAlpha=.5,d.moveTo(u,s),d.lineTo(u,0),d.moveTo(s,u),d.lineTo(0,u),d.stroke();const h=a.toDataURL(\"image/png\");p.setAttribute(\"width\",s),p.setAttribute(\"height\",s),p.parentNode.setAttribute(\"width\",s),p.parentNode.setAttribute(\"height\",s),t.setHref(p,h)},gridUpdate=()=>{d&&updateGrid(t.getZoom()),n(\"canvasGrid\").style.display=d?\"block\":\"none\",n(\"view_grid\").pressed=d};return{name:e.i18next.t(\"\".concat(\"grid\",\":name\")),zoomChanged(e){d&&updateGrid(e)},callback(){const t=document.createElement(\"template\"),i=\"\".concat(\"grid\",\":buttons.0.title\");t.innerHTML='\\n          <se-button id=\"view_grid\" title=\"'.concat(i,'\" src=\"grid.svg\"></se-button>\\n        '),n(\"editor_panel\").append(t.content.cloneNode(!0)),n(\"view_grid\").addEventListener(\"click\",(()=>{e.configObj.curConfig.showGrid=d=!d,gridUpdate()})),d&&gridUpdate()}}}},t=Object.freeze({__proto__:null,default:{name:\"View Grid\",buttons:[{title:\"Show/Hide Grid\"}]}}),n=Object.freeze({__proto__:null,default:{name:\"Grille\",buttons:[{title:\"Afficher/Cacher Grille\"}]}}),i=Object.freeze({__proto__:null,default:{name:\"网格视图\",buttons:[{title:\"显示/隐藏网格\"}]}});export{e as default};\n//# sourceMappingURL=ext-grid.js.map\n"]},"metadata":{},"sourceType":"module"}