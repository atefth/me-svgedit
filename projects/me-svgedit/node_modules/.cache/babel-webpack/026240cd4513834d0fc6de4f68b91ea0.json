{"ast":null,"code":"import _asyncToGenerator from \"C:/Projects/lib-workspace/node_modules/@angular-devkit/build-angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\n/**\n * @file ext-markers.js\n *\n * @license Apache-2.0\n *\n * @copyright 2010 Will Schleter based on ext-arrows.js by Copyright(c) 2010 Alexis Deveria\n * @copyright 2021 OptimistikSAS\n *\n * This extension provides for the addition of markers to the either end\n * or the middle of a line, polyline, path, polygon.\n *\n * Markers are graphics\n *\n * to simplify the coding and make the implementation as robust as possible,\n * markers are not shared - every object has its own set of markers.\n * this relationship is maintained by a naming convention between the\n * ids of the markers and the ids of the object\n *\n * The following restrictions exist for simplicty of use and programming\n *    objects and their markers to have the same color\n *    marker size is fixed\n *    an application specific attribute - se_type - is added to each marker element\n *        to store the type of marker\n *\n * @todo\n *    remove some of the restrictions above\n *\n*/\nvar t = {\n  name: \"markers\",\n\n  init() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const {\n        svgCanvas: t\n      } = _this,\n            {\n        BatchCommand: e,\n        RemoveElementCommand: r,\n        InsertElementCommand: n\n      } = t.history,\n            {\n        $id: a,\n        addSVGElementsFromJson: i\n      } = t,\n            o = [\"start\", \"mid\", \"end\"],\n            s = [\"line\", \"path\", \"polyline\", \"polygon\"],\n            l = {\n        nomarker: {},\n        leftarrow: {\n          element: \"path\",\n          attr: {\n            d: \"M0,50 L100,90 L70,50 L100,10 Z\"\n          }\n        },\n        rightarrow: {\n          element: \"path\",\n          attr: {\n            d: \"M100,50 L0,90 L30,50 L0,10 Z\"\n          }\n        },\n        box: {\n          element: \"path\",\n          attr: {\n            d: \"M20,20 L20,80 L80,80 L80,20 Z\"\n          }\n        },\n        mcircle: {\n          element: \"circle\",\n          attr: {\n            r: 30,\n            cx: 50,\n            cy: 50\n          }\n        }\n      };\n      [\"leftarrow\", \"rightarrow\", \"box\", \"mcircle\"].forEach(t => {\n        l[t + \"_o\"] = l[t];\n      });\n\n      const getLinked = (e, r) => {\n        const n = e.getAttribute(r);\n        if (!n) return null;\n        const a = n.match(/\\(#(.*)\\)/);\n        return a && 2 === a.length ? t.getElement(a[1]) : null;\n      },\n            showPanel = (t, e) => {\n        a(\"marker_panel\").style.display = t ? \"block\" : \"none\", t && e && o.forEach(t => {\n          var r;\n          const n = getLinked(e, \"marker-\" + t);\n          null != n && null !== (r = n.attributes) && void 0 !== r && r.se_type ? a(\"\".concat(t, \"_marker_list_opts\")).setAttribute(\"value\", n.attributes.se_type.value) : a(\"\".concat(t, \"_marker_list_opts\")).setAttribute(\"value\", \"nomarker\");\n        });\n      },\n            addMarker = (e, r) => {\n        const n = t.getSelectedElements();\n        let a = t.getElement(e);\n        if (a) return;\n        if (\"\" === r || \"nomarker\" === r) return;\n        const o = n[0].getAttribute(\"stroke\");\n        if (!l[r]) return void console.error(\"unknown marker type: \".concat(r));\n        a = i({\n          element: \"marker\",\n          attr: {\n            id: e,\n            markerUnits: \"strokeWidth\",\n            orient: \"auto\",\n            style: \"pointer-events:none\",\n            se_type: r\n          }\n        });\n        const s = i(l[r]),\n              c = \"_o\" === r.substr(-2) ? \"none\" : o;\n        return s.setAttribute(\"fill\", c), s.setAttribute(\"stroke\", o), s.setAttribute(\"stroke-width\", 10), a.append(s), a.setAttribute(\"viewBox\", \"0 0 100 100\"), a.setAttribute(\"markerWidth\", 5), a.setAttribute(\"markerHeight\", 5), a.setAttribute(\"refX\", 50), a.setAttribute(\"refY\", 50), t.findDefs().append(a), a;\n      },\n            setMarker = (a, s) => {\n        const l = t.getSelectedElements();\n        if (0 === l.length) return;\n        const c = \"marker-\" + a,\n              m = l[0],\n              u = getLinked(m, c);\n        u && u.remove(), m.removeAttribute(c);\n        let d = s;\n        if (\"\" === d && (d = \"nomarker\"), \"nomarker\" === d) return void t.call(\"changed\", l);\n        const b = \"mkr_\" + a + \"_\" + m.id;\n        addMarker(b, d), t.changeSelectedAttribute(c, \"url(#\" + b + \")\"), \"line\" === m.tagName && \"mid\" === a && (a => {\n          if (\"line\" !== a.tagName) return a;\n          const s = Number(a.getAttribute(\"x1\")),\n                l = Number(a.getAttribute(\"x2\")),\n                c = Number(a.getAttribute(\"y1\")),\n                m = Number(a.getAttribute(\"y2\")),\n                {\n            id: u\n          } = a,\n                d = i({\n            element: \"polyline\",\n            attr: {\n              points: s + \",\" + c + \" \" + (s + l) / 2 + \",\" + (c + m) / 2 + \" \" + l + \",\" + m,\n              stroke: a.getAttribute(\"stroke\"),\n              \"stroke-width\": a.getAttribute(\"stroke-width\"),\n              fill: \"none\",\n              opacity: a.getAttribute(\"opacity\") || 1\n            }\n          });\n          o.forEach(t => {\n            const e = \"marker-\" + t;\n            a.getAttribute(e) && d.setAttribute(e, a.getAttribute(e));\n          });\n          const b = new e();\n          b.addSubCommand(new r(a, a.parentNode)), b.addSubCommand(new n(d)), a.insertAdjacentElement(\"afterend\", d), a.remove(), t.clearSelection(), d.id = u, t.addToSelection([d]), t.addCommandToHistory(b);\n        })(m), t.call(\"changed\", l);\n      };\n\n      return {\n        name: _this.i18next.t(\"\".concat(name, \":name\")),\n\n        callback() {\n          const t = document.createElement(\"template\");\n          let e = '<div id=\"marker_panel\">';\n          o.forEach(t => {\n            e += '<se-list id=\"'.concat(t, '_marker_list_opts\" title=\"tools.').concat(t, '_marker_list_opts\" label=\"\" width=\"22px\" height=\"22px\">'), Object.entries(l).forEach(r => {\n              let [n, a] = r;\n              e += '<se-list-item id=\"mkr_'.concat(t, \"_\").concat(n, '\" value=\"').concat(n, '\" title=\"tools.mkr_').concat(n, '\" src=\"').concat(n, '.svg\" img-height=\"22px\"></se-list-item>');\n            }), e += \"</se-list>\";\n          }), e += \"</div>\", t.innerHTML = e, a(\"tools_top\").appendChild(t.content.cloneNode(!0)), showPanel(!1), o.forEach(t => {\n            a(\"\".concat(t, \"_marker_list_opts\")).addEventListener(\"change\", e => {\n              setMarker(t, e.detail.value);\n            });\n          });\n        },\n\n        selectedChanged(t) {\n          0 === t.elems.length && showPanel(!1), t.elems.forEach(e => {\n            e && s.includes(e.tagName) && t.selectedElement && !t.multiselected ? showPanel(!0, e) : showPanel(!1);\n          });\n        },\n\n        elementChanged(e) {\n          const r = e.elems[0];\n          r && (r.getAttribute(\"marker-start\") || r.getAttribute(\"marker-mid\") || r.getAttribute(\"marker-end\")) && ((t => {\n            const e = t.getAttribute(\"stroke\");\n            o.forEach(r => {\n              const n = getLinked(t, \"marker-\" + r);\n              if (!n) return;\n              if (!n.attributes.se_type) return;\n              const a = n.lastElementChild;\n              if (!a) return;\n              const i = a.getAttribute(\"fill\"),\n                    o = a.getAttribute(\"stroke\");\n              i && \"none\" !== i && a.setAttribute(\"fill\", e), o && \"none\" !== o && a.setAttribute(\"stroke\", e);\n            });\n          })(r), (e => {\n            const r = t.getSelectedElements();\n            o.forEach(n => {\n              const a = \"marker-\" + n,\n                    i = getLinked(e, a);\n              if (!i || !i.attributes.se_type) return;\n              const o = e.getAttribute(a);\n\n              if (o) {\n                const s = e.id.length,\n                      l = o.substr(-s - 1, s);\n\n                if (e.id !== l) {\n                  const o = \"mkr_\" + n + \"_\" + e.id;\n                  addMarker(o, i.attributes.se_type.value), t.changeSelectedAttribute(a, \"url(#\" + o + \")\"), t.call(\"changed\", r);\n                }\n              }\n            });\n          })(r));\n        }\n\n      };\n    })();\n  }\n\n};\nexport { t as default }; //# sourceMappingURL=ext-markers.js.map","map":{"version":3,"sources":["C:/Projects/lib-workspace/node_modules/svgedit/dist/editor/extensions/ext-markers/ext-markers.js"],"names":["t","name","init","svgCanvas","BatchCommand","e","RemoveElementCommand","r","InsertElementCommand","n","history","$id","a","addSVGElementsFromJson","i","o","s","l","nomarker","leftarrow","element","attr","d","rightarrow","box","mcircle","cx","cy","forEach","getLinked","getAttribute","match","length","getElement","showPanel","style","display","attributes","se_type","concat","setAttribute","value","addMarker","getSelectedElements","console","error","id","markerUnits","orient","c","substr","append","findDefs","setMarker","m","u","remove","removeAttribute","call","b","changeSelectedAttribute","tagName","Number","points","stroke","fill","opacity","addSubCommand","parentNode","insertAdjacentElement","clearSelection","addToSelection","addCommandToHistory","i18next","callback","document","createElement","Object","entries","innerHTML","appendChild","content","cloneNode","addEventListener","detail","selectedChanged","elems","includes","selectedElement","multiselected","elementChanged","lastElementChild","default"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIA,CAAC,GAAC;AAACC,EAAAA,IAAI,EAAC,SAAN;;AAAsBC,EAAAA,IAAN,GAAY;AAAA;;AAAA;AAAC,YAAK;AAACC,QAAAA,SAAS,EAACH;AAAX,UAAc,KAAnB;AAAA,YAAwB;AAACI,QAAAA,YAAY,EAACC,CAAd;AAAgBC,QAAAA,oBAAoB,EAACC,CAArC;AAAuCC,QAAAA,oBAAoB,EAACC;AAA5D,UAA+DT,CAAC,CAACU,OAAzF;AAAA,YAAiG;AAACC,QAAAA,GAAG,EAACC,CAAL;AAAOC,QAAAA,sBAAsB,EAACC;AAA9B,UAAiCd,CAAlI;AAAA,YAAoIe,CAAC,GAAC,CAAC,OAAD,EAAS,KAAT,EAAe,KAAf,CAAtI;AAAA,YAA4JC,CAAC,GAAC,CAAC,MAAD,EAAQ,MAAR,EAAe,UAAf,EAA0B,SAA1B,CAA9J;AAAA,YAAmMC,CAAC,GAAC;AAACC,QAAAA,QAAQ,EAAC,EAAV;AAAaC,QAAAA,SAAS,EAAC;AAACC,UAAAA,OAAO,EAAC,MAAT;AAAgBC,UAAAA,IAAI,EAAC;AAACC,YAAAA,CAAC,EAAC;AAAH;AAArB,SAAvB;AAAkFC,QAAAA,UAAU,EAAC;AAACH,UAAAA,OAAO,EAAC,MAAT;AAAgBC,UAAAA,IAAI,EAAC;AAACC,YAAAA,CAAC,EAAC;AAAH;AAArB,SAA7F;AAAsJE,QAAAA,GAAG,EAAC;AAACJ,UAAAA,OAAO,EAAC,MAAT;AAAgBC,UAAAA,IAAI,EAAC;AAACC,YAAAA,CAAC,EAAC;AAAH;AAArB,SAA1J;AAAoNG,QAAAA,OAAO,EAAC;AAACL,UAAAA,OAAO,EAAC,QAAT;AAAkBC,UAAAA,IAAI,EAAC;AAACd,YAAAA,CAAC,EAAC,EAAH;AAAMmB,YAAAA,EAAE,EAAC,EAAT;AAAYC,YAAAA,EAAE,EAAC;AAAf;AAAvB;AAA5N,OAArM;AAA6c,OAAC,WAAD,EAAa,YAAb,EAA0B,KAA1B,EAAgC,SAAhC,EAA2CC,OAA3C,CAAoD5B,CAAC,IAAE;AAACiB,QAAAA,CAAC,CAACjB,CAAC,GAAC,IAAH,CAAD,GAAUiB,CAAC,CAACjB,CAAD,CAAX;AAAe,OAAvE;;AAA0E,YAAM6B,SAAS,GAAC,CAACxB,CAAD,EAAGE,CAAH,KAAO;AAAC,cAAME,CAAC,GAACJ,CAAC,CAACyB,YAAF,CAAevB,CAAf,CAAR;AAA0B,YAAG,CAACE,CAAJ,EAAM,OAAO,IAAP;AAAY,cAAMG,CAAC,GAACH,CAAC,CAACsB,KAAF,CAAQ,WAAR,CAAR;AAA6B,eAAOnB,CAAC,IAAE,MAAIA,CAAC,CAACoB,MAAT,GAAgBhC,CAAC,CAACiC,UAAF,CAAarB,CAAC,CAAC,CAAD,CAAd,CAAhB,GAAmC,IAA1C;AAA+C,OAAhJ;AAAA,YAAiJsB,SAAS,GAAC,CAAClC,CAAD,EAAGK,CAAH,KAAO;AAACO,QAAAA,CAAC,CAAC,cAAD,CAAD,CAAkBuB,KAAlB,CAAwBC,OAAxB,GAAgCpC,CAAC,GAAC,OAAD,GAAS,MAA1C,EAAiDA,CAAC,IAAEK,CAAH,IAAMU,CAAC,CAACa,OAAF,CAAW5B,CAAC,IAAE;AAAC,cAAIO,CAAJ;AAAM,gBAAME,CAAC,GAACoB,SAAS,CAACxB,CAAD,EAAG,YAAUL,CAAb,CAAjB;AAAiC,kBAAMS,CAAN,IAAS,UAAQF,CAAC,GAACE,CAAC,CAAC4B,UAAZ,CAAT,IAAkC,KAAK,CAAL,KAAS9B,CAA3C,IAA8CA,CAAC,CAAC+B,OAAhD,GAAwD1B,CAAC,CAAC,GAAG2B,MAAH,CAAUvC,CAAV,EAAY,mBAAZ,CAAD,CAAD,CAAoCwC,YAApC,CAAiD,OAAjD,EAAyD/B,CAAC,CAAC4B,UAAF,CAAaC,OAAb,CAAqBG,KAA9E,CAAxD,GAA6I7B,CAAC,CAAC,GAAG2B,MAAH,CAAUvC,CAAV,EAAY,mBAAZ,CAAD,CAAD,CAAoCwC,YAApC,CAAiD,OAAjD,EAAyD,UAAzD,CAA7I;AAAkN,SAAxQ,CAAvD;AAAkU,OAAre;AAAA,YAAseE,SAAS,GAAC,CAACrC,CAAD,EAAGE,CAAH,KAAO;AAAC,cAAME,CAAC,GAACT,CAAC,CAAC2C,mBAAF,EAAR;AAAgC,YAAI/B,CAAC,GAACZ,CAAC,CAACiC,UAAF,CAAa5B,CAAb,CAAN;AAAsB,YAAGO,CAAH,EAAK;AAAO,YAAG,OAAKL,CAAL,IAAQ,eAAaA,CAAxB,EAA0B;AAAO,cAAMQ,CAAC,GAACN,CAAC,CAAC,CAAD,CAAD,CAAKqB,YAAL,CAAkB,QAAlB,CAAR;AAAoC,YAAG,CAACb,CAAC,CAACV,CAAD,CAAL,EAAS,OAAO,KAAKqC,OAAO,CAACC,KAAR,CAAc,wBAAwBN,MAAxB,CAA+BhC,CAA/B,CAAd,CAAZ;AAA6DK,QAAAA,CAAC,GAACE,CAAC,CAAC;AAACM,UAAAA,OAAO,EAAC,QAAT;AAAkBC,UAAAA,IAAI,EAAC;AAACyB,YAAAA,EAAE,EAACzC,CAAJ;AAAM0C,YAAAA,WAAW,EAAC,aAAlB;AAAgCC,YAAAA,MAAM,EAAC,MAAvC;AAA8Cb,YAAAA,KAAK,EAAC,qBAApD;AAA0EG,YAAAA,OAAO,EAAC/B;AAAlF;AAAvB,SAAD,CAAH;AAAkH,cAAMS,CAAC,GAACF,CAAC,CAACG,CAAC,CAACV,CAAD,CAAF,CAAT;AAAA,cAAgB0C,CAAC,GAAC,SAAO1C,CAAC,CAAC2C,MAAF,CAAS,CAAC,CAAV,CAAP,GAAoB,MAApB,GAA2BnC,CAA7C;AAA+C,eAAOC,CAAC,CAACwB,YAAF,CAAe,MAAf,EAAsBS,CAAtB,GAAyBjC,CAAC,CAACwB,YAAF,CAAe,QAAf,EAAwBzB,CAAxB,CAAzB,EAAoDC,CAAC,CAACwB,YAAF,CAAe,cAAf,EAA8B,EAA9B,CAApD,EAAsF5B,CAAC,CAACuC,MAAF,CAASnC,CAAT,CAAtF,EAAkGJ,CAAC,CAAC4B,YAAF,CAAe,SAAf,EAAyB,aAAzB,CAAlG,EAA0I5B,CAAC,CAAC4B,YAAF,CAAe,aAAf,EAA6B,CAA7B,CAA1I,EAA0K5B,CAAC,CAAC4B,YAAF,CAAe,cAAf,EAA8B,CAA9B,CAA1K,EAA2M5B,CAAC,CAAC4B,YAAF,CAAe,MAAf,EAAsB,EAAtB,CAA3M,EAAqO5B,CAAC,CAAC4B,YAAF,CAAe,MAAf,EAAsB,EAAtB,CAArO,EAA+PxC,CAAC,CAACoD,QAAF,GAAaD,MAAb,CAAoBvC,CAApB,CAA/P,EAAsRA,CAA7R;AAA+R,OAAroC;AAAA,YAAsoCyC,SAAS,GAAC,CAACzC,CAAD,EAAGI,CAAH,KAAO;AAAC,cAAMC,CAAC,GAACjB,CAAC,CAAC2C,mBAAF,EAAR;AAAgC,YAAG,MAAI1B,CAAC,CAACe,MAAT,EAAgB;AAAO,cAAMiB,CAAC,GAAC,YAAUrC,CAAlB;AAAA,cAAoB0C,CAAC,GAACrC,CAAC,CAAC,CAAD,CAAvB;AAAA,cAA2BsC,CAAC,GAAC1B,SAAS,CAACyB,CAAD,EAAGL,CAAH,CAAtC;AAA4CM,QAAAA,CAAC,IAAEA,CAAC,CAACC,MAAF,EAAH,EAAcF,CAAC,CAACG,eAAF,CAAkBR,CAAlB,CAAd;AAAmC,YAAI3B,CAAC,GAACN,CAAN;AAAQ,YAAG,OAAKM,CAAL,KAASA,CAAC,GAAC,UAAX,GAAuB,eAAaA,CAAvC,EAAyC,OAAO,KAAKtB,CAAC,CAAC0D,IAAF,CAAO,SAAP,EAAiBzC,CAAjB,CAAZ;AAAgC,cAAM0C,CAAC,GAAC,SAAO/C,CAAP,GAAS,GAAT,GAAa0C,CAAC,CAACR,EAAvB;AAA0BJ,QAAAA,SAAS,CAACiB,CAAD,EAAGrC,CAAH,CAAT,EAAetB,CAAC,CAAC4D,uBAAF,CAA0BX,CAA1B,EAA4B,UAAQU,CAAR,GAAU,GAAtC,CAAf,EAA0D,WAASL,CAAC,CAACO,OAAX,IAAoB,UAAQjD,CAA5B,IAA+B,CAACA,CAAC,IAAE;AAAC,cAAG,WAASA,CAAC,CAACiD,OAAd,EAAsB,OAAOjD,CAAP;AAAS,gBAAMI,CAAC,GAAC8C,MAAM,CAAClD,CAAC,CAACkB,YAAF,CAAe,IAAf,CAAD,CAAd;AAAA,gBAAqCb,CAAC,GAAC6C,MAAM,CAAClD,CAAC,CAACkB,YAAF,CAAe,IAAf,CAAD,CAA7C;AAAA,gBAAoEmB,CAAC,GAACa,MAAM,CAAClD,CAAC,CAACkB,YAAF,CAAe,IAAf,CAAD,CAA5E;AAAA,gBAAmGwB,CAAC,GAACQ,MAAM,CAAClD,CAAC,CAACkB,YAAF,CAAe,IAAf,CAAD,CAA3G;AAAA,gBAAkI;AAACgB,YAAAA,EAAE,EAACS;AAAJ,cAAO3C,CAAzI;AAAA,gBAA2IU,CAAC,GAACR,CAAC,CAAC;AAACM,YAAAA,OAAO,EAAC,UAAT;AAAoBC,YAAAA,IAAI,EAAC;AAAC0C,cAAAA,MAAM,EAAC/C,CAAC,GAAC,GAAF,GAAMiC,CAAN,GAAQ,GAAR,GAAY,CAACjC,CAAC,GAACC,CAAH,IAAM,CAAlB,GAAoB,GAApB,GAAwB,CAACgC,CAAC,GAACK,CAAH,IAAM,CAA9B,GAAgC,GAAhC,GAAoCrC,CAApC,GAAsC,GAAtC,GAA0CqC,CAAlD;AAAoDU,cAAAA,MAAM,EAACpD,CAAC,CAACkB,YAAF,CAAe,QAAf,CAA3D;AAAoF,8BAAelB,CAAC,CAACkB,YAAF,CAAe,cAAf,CAAnG;AAAkImC,cAAAA,IAAI,EAAC,MAAvI;AAA8IC,cAAAA,OAAO,EAACtD,CAAC,CAACkB,YAAF,CAAe,SAAf,KAA2B;AAAjL;AAAzB,WAAD,CAA9I;AAA8Vf,UAAAA,CAAC,CAACa,OAAF,CAAW5B,CAAC,IAAE;AAAC,kBAAMK,CAAC,GAAC,YAAUL,CAAlB;AAAoBY,YAAAA,CAAC,CAACkB,YAAF,CAAezB,CAAf,KAAmBiB,CAAC,CAACkB,YAAF,CAAenC,CAAf,EAAiBO,CAAC,CAACkB,YAAF,CAAezB,CAAf,CAAjB,CAAnB;AAAuD,WAA1F;AAA6F,gBAAMsD,CAAC,GAAC,IAAItD,CAAJ,EAAR;AAAcsD,UAAAA,CAAC,CAACQ,aAAF,CAAgB,IAAI5D,CAAJ,CAAMK,CAAN,EAAQA,CAAC,CAACwD,UAAV,CAAhB,GAAuCT,CAAC,CAACQ,aAAF,CAAgB,IAAI1D,CAAJ,CAAMa,CAAN,CAAhB,CAAvC,EAAiEV,CAAC,CAACyD,qBAAF,CAAwB,UAAxB,EAAmC/C,CAAnC,CAAjE,EAAuGV,CAAC,CAAC4C,MAAF,EAAvG,EAAkHxD,CAAC,CAACsE,cAAF,EAAlH,EAAqIhD,CAAC,CAACwB,EAAF,GAAKS,CAA1I,EAA4IvD,CAAC,CAACuE,cAAF,CAAiB,CAACjD,CAAD,CAAjB,CAA5I,EAAkKtB,CAAC,CAACwE,mBAAF,CAAsBb,CAAtB,CAAlK;AAA2L,SAAxqB,EAA0qBL,CAA1qB,CAAzF,EAAswBtD,CAAC,CAAC0D,IAAF,CAAO,SAAP,EAAiBzC,CAAjB,CAAtwB;AAA0xB,OAAnqE;;AAAoqE,aAAM;AAAChB,QAAAA,IAAI,EAAC,KAAI,CAACwE,OAAL,CAAazE,CAAb,CAAe,GAAGuC,MAAH,CAAUtC,IAAV,EAAe,OAAf,CAAf,CAAN;;AAA8CyE,QAAAA,QAAQ,GAAE;AAAC,gBAAM1E,CAAC,GAAC2E,QAAQ,CAACC,aAAT,CAAuB,UAAvB,CAAR;AAA2C,cAAIvE,CAAC,GAAC,yBAAN;AAAgCU,UAAAA,CAAC,CAACa,OAAF,CAAW5B,CAAC,IAAE;AAACK,YAAAA,CAAC,IAAE,gBAAgBkC,MAAhB,CAAuBvC,CAAvB,EAAyB,kCAAzB,EAA6DuC,MAA7D,CAAoEvC,CAApE,EAAsE,yDAAtE,CAAH,EAAoI6E,MAAM,CAACC,OAAP,CAAe7D,CAAf,EAAkBW,OAAlB,CAA2BrB,CAAC,IAAE;AAAC,kBAAG,CAACE,CAAD,EAAGG,CAAH,IAAML,CAAT;AAAWF,cAAAA,CAAC,IAAE,yBAAyBkC,MAAzB,CAAgCvC,CAAhC,EAAkC,GAAlC,EAAuCuC,MAAvC,CAA8C9B,CAA9C,EAAgD,WAAhD,EAA6D8B,MAA7D,CAAoE9B,CAApE,EAAsE,qBAAtE,EAA6F8B,MAA7F,CAAoG9B,CAApG,EAAsG,SAAtG,EAAiH8B,MAAjH,CAAwH9B,CAAxH,EAA0H,yCAA1H,CAAH;AAAwK,aAAlN,CAApI,EAAyVJ,CAAC,IAAE,YAA5V;AAAyW,WAAxX,GAA2XA,CAAC,IAAE,QAA9X,EAAuYL,CAAC,CAAC+E,SAAF,GAAY1E,CAAnZ,EAAqZO,CAAC,CAAC,WAAD,CAAD,CAAeoE,WAAf,CAA2BhF,CAAC,CAACiF,OAAF,CAAUC,SAAV,CAAoB,CAAC,CAArB,CAA3B,CAArZ,EAAychD,SAAS,CAAC,CAAC,CAAF,CAAld,EAAudnB,CAAC,CAACa,OAAF,CAAW5B,CAAC,IAAE;AAACY,YAAAA,CAAC,CAAC,GAAG2B,MAAH,CAAUvC,CAAV,EAAY,mBAAZ,CAAD,CAAD,CAAoCmF,gBAApC,CAAqD,QAArD,EAA+D9E,CAAC,IAAE;AAACgD,cAAAA,SAAS,CAACrD,CAAD,EAAGK,CAAC,CAAC+E,MAAF,CAAS3C,KAAZ,CAAT;AAA4B,aAA/F;AAAkG,WAAjH,CAAvd;AAA2kB,SAA/sB;;AAAgtB4C,QAAAA,eAAe,CAACrF,CAAD,EAAG;AAAC,gBAAIA,CAAC,CAACsF,KAAF,CAAQtD,MAAZ,IAAoBE,SAAS,CAAC,CAAC,CAAF,CAA7B,EAAkClC,CAAC,CAACsF,KAAF,CAAQ1D,OAAR,CAAiBvB,CAAC,IAAE;AAACA,YAAAA,CAAC,IAAEW,CAAC,CAACuE,QAAF,CAAWlF,CAAC,CAACwD,OAAb,CAAH,IAA0B7D,CAAC,CAACwF,eAA5B,IAA6C,CAACxF,CAAC,CAACyF,aAAhD,GAA8DvD,SAAS,CAAC,CAAC,CAAF,EAAI7B,CAAJ,CAAvE,GAA8E6B,SAAS,CAAC,CAAC,CAAF,CAAvF;AAA4F,WAAjH,CAAlC;AAAsJ,SAAz3B;;AAA03BwD,QAAAA,cAAc,CAACrF,CAAD,EAAG;AAAC,gBAAME,CAAC,GAACF,CAAC,CAACiF,KAAF,CAAQ,CAAR,CAAR;AAAmB/E,UAAAA,CAAC,KAAGA,CAAC,CAACuB,YAAF,CAAe,cAAf,KAAgCvB,CAAC,CAACuB,YAAF,CAAe,YAAf,CAAhC,IAA8DvB,CAAC,CAACuB,YAAF,CAAe,YAAf,CAAjE,CAAD,KAAkG,CAAC9B,CAAC,IAAE;AAAC,kBAAMK,CAAC,GAACL,CAAC,CAAC8B,YAAF,CAAe,QAAf,CAAR;AAAiCf,YAAAA,CAAC,CAACa,OAAF,CAAWrB,CAAC,IAAE;AAAC,oBAAME,CAAC,GAACoB,SAAS,CAAC7B,CAAD,EAAG,YAAUO,CAAb,CAAjB;AAAiC,kBAAG,CAACE,CAAJ,EAAM;AAAO,kBAAG,CAACA,CAAC,CAAC4B,UAAF,CAAaC,OAAjB,EAAyB;AAAO,oBAAM1B,CAAC,GAACH,CAAC,CAACkF,gBAAV;AAA2B,kBAAG,CAAC/E,CAAJ,EAAM;AAAO,oBAAME,CAAC,GAACF,CAAC,CAACkB,YAAF,CAAe,MAAf,CAAR;AAAA,oBAA+Bf,CAAC,GAACH,CAAC,CAACkB,YAAF,CAAe,QAAf,CAAjC;AAA0DhB,cAAAA,CAAC,IAAE,WAASA,CAAZ,IAAeF,CAAC,CAAC4B,YAAF,CAAe,MAAf,EAAsBnC,CAAtB,CAAf,EAAwCU,CAAC,IAAE,WAASA,CAAZ,IAAeH,CAAC,CAAC4B,YAAF,CAAe,QAAf,EAAwBnC,CAAxB,CAAvD;AAAkF,aAAjR;AAAoR,WAA1T,EAA4TE,CAA5T,GAA+T,CAACF,CAAC,IAAE;AAAC,kBAAME,CAAC,GAACP,CAAC,CAAC2C,mBAAF,EAAR;AAAgC5B,YAAAA,CAAC,CAACa,OAAF,CAAWnB,CAAC,IAAE;AAAC,oBAAMG,CAAC,GAAC,YAAUH,CAAlB;AAAA,oBAAoBK,CAAC,GAACe,SAAS,CAACxB,CAAD,EAAGO,CAAH,CAA/B;AAAqC,kBAAG,CAACE,CAAD,IAAI,CAACA,CAAC,CAACuB,UAAF,CAAaC,OAArB,EAA6B;AAAO,oBAAMvB,CAAC,GAACV,CAAC,CAACyB,YAAF,CAAelB,CAAf,CAAR;;AAA0B,kBAAGG,CAAH,EAAK;AAAC,sBAAMC,CAAC,GAACX,CAAC,CAACyC,EAAF,CAAKd,MAAb;AAAA,sBAAoBf,CAAC,GAACF,CAAC,CAACmC,MAAF,CAAS,CAAClC,CAAD,GAAG,CAAZ,EAAcA,CAAd,CAAtB;;AAAuC,oBAAGX,CAAC,CAACyC,EAAF,KAAO7B,CAAV,EAAY;AAAC,wBAAMF,CAAC,GAAC,SAAON,CAAP,GAAS,GAAT,GAAaJ,CAAC,CAACyC,EAAvB;AAA0BJ,kBAAAA,SAAS,CAAC3B,CAAD,EAAGD,CAAC,CAACuB,UAAF,CAAaC,OAAb,CAAqBG,KAAxB,CAAT,EAAwCzC,CAAC,CAAC4D,uBAAF,CAA0BhD,CAA1B,EAA4B,UAAQG,CAAR,GAAU,GAAtC,CAAxC,EAAmFf,CAAC,CAAC0D,IAAF,CAAO,SAAP,EAAiBnD,CAAjB,CAAnF;AAAuG;AAAC;AAAC,aAA/S;AAAkT,WAAvV,EAAyVA,CAAzV,CAAja;AAA8vB;;AAA7pD,OAAN;AAA5rF;AAAi2I;;AAA73I,CAAN;AAAq4I,SAAOP,CAAC,IAAI4F,OAAZ,G,CACr4I","sourcesContent":["/**\n * @file ext-markers.js\n *\n * @license Apache-2.0\n *\n * @copyright 2010 Will Schleter based on ext-arrows.js by Copyright(c) 2010 Alexis Deveria\n * @copyright 2021 OptimistikSAS\n *\n * This extension provides for the addition of markers to the either end\n * or the middle of a line, polyline, path, polygon.\n *\n * Markers are graphics\n *\n * to simplify the coding and make the implementation as robust as possible,\n * markers are not shared - every object has its own set of markers.\n * this relationship is maintained by a naming convention between the\n * ids of the markers and the ids of the object\n *\n * The following restrictions exist for simplicty of use and programming\n *    objects and their markers to have the same color\n *    marker size is fixed\n *    an application specific attribute - se_type - is added to each marker element\n *        to store the type of marker\n *\n * @todo\n *    remove some of the restrictions above\n *\n*/\nvar t={name:\"markers\",async init(){const{svgCanvas:t}=this,{BatchCommand:e,RemoveElementCommand:r,InsertElementCommand:n}=t.history,{$id:a,addSVGElementsFromJson:i}=t,o=[\"start\",\"mid\",\"end\"],s=[\"line\",\"path\",\"polyline\",\"polygon\"],l={nomarker:{},leftarrow:{element:\"path\",attr:{d:\"M0,50 L100,90 L70,50 L100,10 Z\"}},rightarrow:{element:\"path\",attr:{d:\"M100,50 L0,90 L30,50 L0,10 Z\"}},box:{element:\"path\",attr:{d:\"M20,20 L20,80 L80,80 L80,20 Z\"}},mcircle:{element:\"circle\",attr:{r:30,cx:50,cy:50}}};[\"leftarrow\",\"rightarrow\",\"box\",\"mcircle\"].forEach((t=>{l[t+\"_o\"]=l[t]}));const getLinked=(e,r)=>{const n=e.getAttribute(r);if(!n)return null;const a=n.match(/\\(#(.*)\\)/);return a&&2===a.length?t.getElement(a[1]):null},showPanel=(t,e)=>{a(\"marker_panel\").style.display=t?\"block\":\"none\",t&&e&&o.forEach((t=>{var r;const n=getLinked(e,\"marker-\"+t);null!=n&&null!==(r=n.attributes)&&void 0!==r&&r.se_type?a(\"\".concat(t,\"_marker_list_opts\")).setAttribute(\"value\",n.attributes.se_type.value):a(\"\".concat(t,\"_marker_list_opts\")).setAttribute(\"value\",\"nomarker\")}))},addMarker=(e,r)=>{const n=t.getSelectedElements();let a=t.getElement(e);if(a)return;if(\"\"===r||\"nomarker\"===r)return;const o=n[0].getAttribute(\"stroke\");if(!l[r])return void console.error(\"unknown marker type: \".concat(r));a=i({element:\"marker\",attr:{id:e,markerUnits:\"strokeWidth\",orient:\"auto\",style:\"pointer-events:none\",se_type:r}});const s=i(l[r]),c=\"_o\"===r.substr(-2)?\"none\":o;return s.setAttribute(\"fill\",c),s.setAttribute(\"stroke\",o),s.setAttribute(\"stroke-width\",10),a.append(s),a.setAttribute(\"viewBox\",\"0 0 100 100\"),a.setAttribute(\"markerWidth\",5),a.setAttribute(\"markerHeight\",5),a.setAttribute(\"refX\",50),a.setAttribute(\"refY\",50),t.findDefs().append(a),a},setMarker=(a,s)=>{const l=t.getSelectedElements();if(0===l.length)return;const c=\"marker-\"+a,m=l[0],u=getLinked(m,c);u&&u.remove(),m.removeAttribute(c);let d=s;if(\"\"===d&&(d=\"nomarker\"),\"nomarker\"===d)return void t.call(\"changed\",l);const b=\"mkr_\"+a+\"_\"+m.id;addMarker(b,d),t.changeSelectedAttribute(c,\"url(#\"+b+\")\"),\"line\"===m.tagName&&\"mid\"===a&&(a=>{if(\"line\"!==a.tagName)return a;const s=Number(a.getAttribute(\"x1\")),l=Number(a.getAttribute(\"x2\")),c=Number(a.getAttribute(\"y1\")),m=Number(a.getAttribute(\"y2\")),{id:u}=a,d=i({element:\"polyline\",attr:{points:s+\",\"+c+\" \"+(s+l)/2+\",\"+(c+m)/2+\" \"+l+\",\"+m,stroke:a.getAttribute(\"stroke\"),\"stroke-width\":a.getAttribute(\"stroke-width\"),fill:\"none\",opacity:a.getAttribute(\"opacity\")||1}});o.forEach((t=>{const e=\"marker-\"+t;a.getAttribute(e)&&d.setAttribute(e,a.getAttribute(e))}));const b=new e;b.addSubCommand(new r(a,a.parentNode)),b.addSubCommand(new n(d)),a.insertAdjacentElement(\"afterend\",d),a.remove(),t.clearSelection(),d.id=u,t.addToSelection([d]),t.addCommandToHistory(b)})(m),t.call(\"changed\",l)};return{name:this.i18next.t(\"\".concat(name,\":name\")),callback(){const t=document.createElement(\"template\");let e='<div id=\"marker_panel\">';o.forEach((t=>{e+='<se-list id=\"'.concat(t,'_marker_list_opts\" title=\"tools.').concat(t,'_marker_list_opts\" label=\"\" width=\"22px\" height=\"22px\">'),Object.entries(l).forEach((r=>{let[n,a]=r;e+='<se-list-item id=\"mkr_'.concat(t,\"_\").concat(n,'\" value=\"').concat(n,'\" title=\"tools.mkr_').concat(n,'\" src=\"').concat(n,'.svg\" img-height=\"22px\"></se-list-item>')})),e+=\"</se-list>\"})),e+=\"</div>\",t.innerHTML=e,a(\"tools_top\").appendChild(t.content.cloneNode(!0)),showPanel(!1),o.forEach((t=>{a(\"\".concat(t,\"_marker_list_opts\")).addEventListener(\"change\",(e=>{setMarker(t,e.detail.value)}))}))},selectedChanged(t){0===t.elems.length&&showPanel(!1),t.elems.forEach((e=>{e&&s.includes(e.tagName)&&t.selectedElement&&!t.multiselected?showPanel(!0,e):showPanel(!1)}))},elementChanged(e){const r=e.elems[0];r&&(r.getAttribute(\"marker-start\")||r.getAttribute(\"marker-mid\")||r.getAttribute(\"marker-end\"))&&((t=>{const e=t.getAttribute(\"stroke\");o.forEach((r=>{const n=getLinked(t,\"marker-\"+r);if(!n)return;if(!n.attributes.se_type)return;const a=n.lastElementChild;if(!a)return;const i=a.getAttribute(\"fill\"),o=a.getAttribute(\"stroke\");i&&\"none\"!==i&&a.setAttribute(\"fill\",e),o&&\"none\"!==o&&a.setAttribute(\"stroke\",e)}))})(r),(e=>{const r=t.getSelectedElements();o.forEach((n=>{const a=\"marker-\"+n,i=getLinked(e,a);if(!i||!i.attributes.se_type)return;const o=e.getAttribute(a);if(o){const s=e.id.length,l=o.substr(-s-1,s);if(e.id!==l){const o=\"mkr_\"+n+\"_\"+e.id;addMarker(o,i.attributes.se_type.value),t.changeSelectedAttribute(a,\"url(#\"+o+\")\"),t.call(\"changed\",r)}}}))})(r))}}}};export{t as default};\n//# sourceMappingURL=ext-markers.js.map\n"]},"metadata":{},"sourceType":"module"}